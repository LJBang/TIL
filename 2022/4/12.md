# 22.04.12
## 운영체제
### 쓰레드
프로세스의 실행 단위라 할 수 있다.  
스레드는 스레드 id(tid), 프로그램 카운터, 레지스터 집합, 스택으로 구성된다.  
프로세스에서 쓰레드를 만들면 스택영역만 할당받고 나머지는 프로세스의 것을 공유한다.  
따라서 같은 프로세스에 속한 다른 스레드와 코드, 데이터 섹션, 열린 파일이나 신호와 같은 자원을 공유한다.
또한 프로세스를 새로 만드는 것보다 속도가 빠름  

#### 멀티 스레드
장점  
- 하나의 프로세스 안에서 여러 작업을 동시에 처리할 수 있어서 시간, 자원적 이득이다
- 스레드끼리 메모리공간을 공유하기 때문에, 데이터의 교환이 쉽다.
- context switch시 캐시 메모리 초기화가 없기 때문에 프로세스의 것보다 더 빠르다.  

단점
- 한 스레드가 메모리의 공유되는 영역을 망가뜨리면 다른 스레드도 영향을 받는다.  
- 따라서 작업 순서를 컨트롤 해줄 동기화 작업이 필요한대, 이로인해 병목현상이 발생해 성능이 저하될 수 있다.  

스레드들은 생성 순서대로 작업을 진행하는 것이 아니라 동시에 진행된다.  


#### 멀티 스레드 서버의 구조
1. 클라이언트가 요청을 보낸다.
2. 요청에 따라 서버는 새로운 스레드를 만들어 클라이언트의 요청을 수행한다.
3. 서버는 새로운 클라이언트의 요청을 기다린다.

#### 멀티코어 프로그래밍
- Parallelism: CPU 여러개에 여러개의 태스크
- Concurrency: CPU 하나에 여러개의 태스크  
Parallelism에는 데이터 공간을 분리하여 각 코어가 같은 일을 수행하는 data parallelism방식과,  
같은 데이터 공간에서 스레드를 나누어 각 작업을 하는 task parallelism방식이 있다.  

#### 스레드의 타입
유저가 쉽게 조작할 수 있는 유저레벨 스레드와  
커널이 조작하는 커널레벨 스레드가 있다.  

유저 레벨 스레드  
- 스레드 기능을 제공하는 라이브러리를 사용해서 조작  
- 사용자 영역에서 스레드 연산을 진행하기 때문에 운영체제에서 인식할 수 없다.
- 운영체제에서 인식할 수 없으므로 해당 프로세스가 멈추면 모든 유저 스레드가 멈춘다.  
- OS수준의 스케쥴링을 지원하지 않아서, 여러 스레드가 랜덤한 순서로 실행되며, 스케쥴링을 위해서는 해당 라이브러리를 이용한다.  
- OS레벨의 스케쥴링이나 동기화를 하지 않기에, 오버헤드가 적고 빠르다.  

커널 레벨 스레드
- 가장 가벼운 커널 스케쥴링 단위이며, 하나의 프로세스는 적어도 하나의 커널 스레드를 가진다.  
- 커널영역에서 스레드 연산을 수행하기에, 커널에 종속적이다.  
- 동작중인 스레드가 시스템콜을 해도 다른 스레드가 계속 실행될 수 있다.  
- 스케쥴링과 동기화를 위해 시스템콜에 오래걸린다.(저장한 내용을 다시 불러오는 과정이 필요)  
- 사용자 모드와 커널 모드의 전환이 빈번하게 이뤄지기 때문에 성능저하가 있다.  

Many-to-One 모델  
- 다수의 유저스레드와 하나의 커널 스레드  
- 하나의 스레드가 블록되면 모든 스레드가 블록된다.  
- 커널에는 하나의 연산만 하기 때문에, 멀티코어 시스템에서 페러렐 하지 않다.  

One-to-One 모델  
- 사용자-커널 스레드가 하나씩 매핑된다.  
- 유저레벨 스레드를 만들면 커널레벨 스레드도 생성된다.  
- M-t-O보다 더 concurrency하다.  
- 오버헤드 때문에, 프로세스당 스레드의 수가 제한될 수 있다.  
- Windows, Linux  

Many-to-Many 모델  
- 다수의 유저레벨 스레드가 다수의 커널레벨 스레드와 매핑된다.  
- OS가 충분한 수의 커널 스레드를 생성할 수 있도록 한다.  

